---
layout: default
---

<div class="tags-page mt-5">
  <h1 class="page-heading text-gradient">{{ page.title }}</h1>

  <!-- 카테고리별 태그 클라우드 -->
  <div class="categories-container mb-5">
    {% assign tag_categories = site.tag_categories %}
    {% assign all_tags = site.tags | sort %}
    {% assign used_tags = "" | split: "" %}

    {% for category in tag_categories %}
      {% assign category_tag_count = 0 %}
      {% for tag_name in category[1] %}
        {% for site_tag in all_tags %}
          {% if site_tag[0] == tag_name %}
            {% assign category_tag_count = category_tag_count | plus: site_tag[1].size %}
          {% endif %}
        {% endfor %}
      {% endfor %}

      <div class="category-group">
        <div class="category-header" data-category="{{ category[0] | slugify }}">
          <div class="category-title-wrapper">
            <span class="category-icon">▶</span>
            <h3 class="category-title">{{ category[0] }}</h3>
            <span class="category-count">({{ category[1].size }})</span>
          </div>
        </div>
        <div class="tag-cloud" data-category-content="{{ category[0] | slugify }}" style="display: none;">
          {% for tag_name in category[1] %}
            {% for site_tag in all_tags %}
              {% if site_tag[0] == tag_name %}
                {% assign tag_size = site_tag[1].size %}
                {% assign used_tags = used_tags | push: tag_name %}
                <button class="tag-cloud-item" data-tag="{{ site_tag[0] | slugify }}" data-tag-size="{{ tag_size }}">
                  {{ site_tag[0] }} 
                  <span class="tag-count">{{ tag_size }}</span>
                </button>
              {% endif %}
            {% endfor %}
          {% endfor %}
        </div>
      </div>
    {% endfor %}

    <!-- 미분류 태그들 (기타) -->
    {% assign has_uncategorized = false %}
    {% for site_tag in all_tags %}
      {% unless used_tags contains site_tag[0] %}
        {% assign has_uncategorized = true %}
        {% break %}
      {% endunless %}
    {% endfor %}

    {% if has_uncategorized %}
      {% assign uncategorized_count = 0 %}
      {% for site_tag in all_tags %}
        {% unless used_tags contains site_tag[0] %}
          {% assign uncategorized_count = uncategorized_count | plus: 1 %}
        {% endunless %}
      {% endfor %}

      <div class="category-group">
        <div class="category-header" data-category="uncategorized">
          <div class="category-title-wrapper">
            <span class="category-icon">▶</span>
            <h3 class="category-title">기타</h3>
            <span class="category-count">({{ uncategorized_count }})</span>
          </div>
        </div>
        <div class="tag-cloud" data-category-content="uncategorized" style="display: none;">
          {% for site_tag in all_tags %}
            {% unless used_tags contains site_tag[0] %}
              {% assign tag_size = site_tag[1].size %}
              <button class="tag-cloud-item" data-tag="{{ site_tag[0] | slugify }}" data-tag-size="{{ tag_size }}">
                {{ site_tag[0] }} 
                <span class="tag-count">{{ tag_size }}</span>
              </button>
            {% endunless %}
          {% endfor %}
        </div>
      </div>
    {% endif %}
  </div>

  <!-- 태그별 포스트 섹션 -->
  <div class="tags-container">
    {% for tag in all_tags %}
      <div class="tag-section" id="{{ tag[0] | slugify }}" style="display: none;">
        <div class="tag-header">
          <h2 class="tag-title">{{ tag[0] }}</h2>
          <span class="tag-badge">{{ tag[1].size }}</span>
        </div>
        <div class="tag-content">
          <div class="posts-grid" data-post-count="{{ tag[1].size }}" data-initial-show="10">
            {% for post in tag[1] %}
              <article class="post-card" data-index="{{ forloop.index }}">
                <div class="post-card-content">
                  <time class="post-date">
                    {%- assign date_format = site.minima.date_format | default: "%b %-d, %Y" -%}
                    {{ post.date | date: date_format }}
                  </time>
                  <h3 class="post-title">
                    <a href="{{ post.url | relative_url }}">{{ post.title | escape }}</a>
                  </h3>
                  {%- if site.show_excerpts -%}
                    <p class="post-excerpt">{{ post.excerpt | strip_html | truncatewords: 20 }}</p>
                  {%- endif -%}
                  
                  {% if post.tags %}
                    <div class="post-tags">
                      {% for tag in post.tags limit: 3 %}
                        <span class="post-tag">{{ tag }}</span>
                      {% endfor %}
                    </div>
                  {% endif %}
                </div>
              </article>
            {% endfor %}
          </div>
          
          <!-- 더보기 버튼 (10개 이상일 때만) -->
          {% if tag[1].size > 10 %}
            <div class="load-more-container text-center mt-3">
              <button class="btn-load-more">
                <span class="load-more-text">더보기</span>
                <span class="remaining-count">({{ tag[1].size | minus: 10 }}개 남음)</span>
              </button>
            </div>
          {% endif %}
        </div>
      </div>
    {% endfor %}
  </div>

  <!-- 안내 메시지 -->
  <div class="info-message text-center mt-4" id="infoMessage">
    <p class="text-muted">카테고리를 펼친 후 태그를 클릭하여 관련 포스트를 확인하세요</p>
  </div>
</div>

{{ content }}

<script>
document.addEventListener('DOMContentLoaded', () => {
  const categoryHeaders = document.querySelectorAll('.category-header');
  const tagButtons = document.querySelectorAll('.tag-cloud-item');
  const tagSections = document.querySelectorAll('.tag-section');
  const infoMessage = document.getElementById('infoMessage');
  let activeTag = null;

  // 카테고리 접기/펼치기
  categoryHeaders.forEach(header => {
    header.addEventListener('click', () => {
      const categoryId = header.dataset.category;
      const content = document.querySelector(`[data-category-content="${categoryId}"]`);
      const icon = header.querySelector('.category-icon');

      if (content.style.display === 'none') {
        content.style.display = 'flex';
        icon.textContent = '▼';
        header.classList.add('expanded');
      } else {
        content.style.display = 'none';
        icon.textContent = '▶';
        header.classList.remove('expanded');
      }
    });
  });

  // 태그 클릭
  tagButtons.forEach(button => {
    button.addEventListener('click', () => {
      const tagId = button.dataset.tag;
      const targetSection = document.getElementById(tagId);

      if (!targetSection) return;

      if (activeTag === tagId) {
        closeActiveTag();
        return;
      }

      tagButtons.forEach(btn => btn.classList.remove('active'));
      tagSections.forEach(section => section.style.display = 'none');

      button.classList.add('active');
      targetSection.style.display = 'block';
      activeTag = tagId;
      infoMessage.classList.add('hidden');

      // 포스트 초기화 (처음 10개만 표시)
      initializePosts(targetSection);

      // 자동 스크롤 제거됨
    });
  });

  function initializePosts(section) {
    const postsGrid = section.querySelector('.posts-grid');
    const loadMoreBtn = section.querySelector('.btn-load-more');
    const postCards = postsGrid.querySelectorAll('.post-card');
    const initialShow = parseInt(postsGrid.dataset.initialShow) || 10;

    // 모든 포스트 숨기기
    postCards.forEach((card, index) => {
      if (index < initialShow) {
        card.style.display = 'block';
      } else {
        card.style.display = 'none';
      }
    });

    // 더보기 버튼 이벤트
    if (loadMoreBtn) {
      const newBtn = loadMoreBtn.cloneNode(true);
      loadMoreBtn.parentNode.replaceChild(newBtn, loadMoreBtn);
      
      newBtn.addEventListener('click', () => {
        loadMorePosts(section);
      });
    }
  }

  function loadMorePosts(section) {
    const postsGrid = section.querySelector('.posts-grid');
    const loadMoreBtn = section.querySelector('.btn-load-more');
    const postCards = postsGrid.querySelectorAll('.post-card');
    const loadCount = 10;

    let visibleCount = 0;
    postCards.forEach(card => {
      if (card.style.display !== 'none') visibleCount++;
    });

    let loaded = 0;
    postCards.forEach((card, index) => {
      if (index >= visibleCount && index < visibleCount + loadCount) {
        card.style.display = 'block';
        loaded++;
      }
    });

    visibleCount += loaded;
    const remaining = postCards.length - visibleCount;

    if (remaining <= 0) {
      loadMoreBtn.style.display = 'none';
    } else {
      const remainingSpan = loadMoreBtn.querySelector('.remaining-count');
      remainingSpan.textContent = `(${remaining}개 남음)`;
    }
  }

  function closeActiveTag() {
    tagButtons.forEach(btn => btn.classList.remove('active'));
    tagSections.forEach(section => section.style.display = 'none');
    activeTag = null;
    infoMessage.classList.remove('hidden');
  }

  document.addEventListener('keydown', e => {
    if (e.key === 'Escape' && activeTag) {
      closeActiveTag();
    }
  });
});
</script>